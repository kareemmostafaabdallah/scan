name: Install sqlmap

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  install-sqlmap:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install prerequisites
        run: |
          set -e
          sudo apt-get update -y
          sudo apt-get install -y git python3 python3-venv python3-pip

      - name: Clone sqlmap repository
        run: |
          set -e
          rm -rf /tmp/sqlmap
          git clone --depth 1 https://github.com/sqlmapproject/sqlmap.git /tmp/sqlmap

      - name: Install sqlmap to /usr/local/bin
        run: |
          set -e
          sudo ln -sf /tmp/sqlmap/sqlmap.py /usr/local/bin/sqlmap
          sudo chmod +x /usr/local/bin/sqlmap

      - name: Verify sqlmap installation
        run: |
          set -e
          if command -v sqlmap >/dev/null 2>&1; then
            echo "sqlmap found at: $(command -v sqlmap)"
            sqlmap --version
          else
            echo "sqlmap not found in PATH"
            ls -la /tmp/sqlmap || true
            exit 1
          fi
