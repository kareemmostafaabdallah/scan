name: Monster Subdomain Enumeration 

on:
  workflow_dispatch:
    inputs:
      domain:
        description: 'Target domain (Ù…Ø«Ù„ wien.gv.at Ø£Ùˆ tesla.com)'
        required: true
        default: 'example.com'

jobs:
  monster:
    runs-on: ubuntu-latest
    timeout-minutes: 360

    env:
      DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        continue-on-error: true

      - name: Setup Go (Clean & No Warnings)
        uses: actions/setup-go@v5
        with:
          go-version: '>=1.23'
          cache: false  # ØµÙØ± warnings

      - name: Install Tools (Ø¨Ø¯ÙˆÙ† Amass - Ø´ØºØ§Ù„ 100% Ù…Ø¶Ù…ÙˆÙ†)
        run: |
          # Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø§Ù„Ø¬Ø§Ù…Ø¯Ø© (Ø¨Ø¯ÙˆÙ† Ø£ÙŠ Ø®Ø·Ø£ ØªØ«Ø¨ÙŠØª)
          go install github.com/projectdiscovery/subfinder/v2/cmd/subfinder@latest
          go install github.com/projectdiscovery/httpx/cmd/httpx@v1.6.9
          go install github.com/tomnomnom/assetfinder@latest
          
          # PATH
          echo "$HOME/go/bin" >> $GITHUB_PATH

          # Findomain (binary Ø³Ø±ÙŠØ¹ ÙˆØ´ØºØ§Ù„)
          curl -sLO https://github.com/Findomain/Findomain/releases/latest/download/findomain-linux.zip
          unzip -o findomain-linux.zip
          chmod +x findomain
          sudo mv findomain /usr/local/bin/

          # jq Ù„Ù„Ù€ JSON parsing
          sudo apt-get update -qq
          sudo apt-get install -y jq -qq

      - name: Validate Discord Webhook
        run: |
          if [ -z "$DISCORD_WEBHOOK" ] || [ "$DISCORD_WEBHOOK" = "***" ]; then
            echo "Warning: No Discord webhook â€“ results in artifacts only"
          else
            echo "Discord webhook ready!"
          fi

      - name: Set Target
        run: |
          echo "TARGET=${{ inputs.domain }}" >> $GITHUB_ENV

      - name: Monster Subdomain Enumeration (7 Ù…ØµØ§Ø¯Ø± Ù‚ÙˆÙŠØ© Ø¬Ø¯Ù‹Ø§ - Ø¨Ø¯ÙˆÙ† Amass)
        run: |
          DOMAIN="${{ inputs.domain }}"
          echo "Ø¬Ø§Ø±ÙŠ Ø¬Ù…Ø¹ ÙƒÙ„ ØµØ¨ Ø¯ÙˆÙ…ÙŠÙ† Ù…Ù† $DOMAIN..."

          # Subfinder (Ø§Ù„Ù…Ù„Ùƒ - Ø£Ù‚ÙˆÙ‰ Ù…ØµØ¯Ø±ØŒ ÙŠØ¬ÙŠØ¨ Ø¢Ù„Ø§Ù Ø§Ù„Ø¯ÙˆÙ…ÙŠÙ†Ø²)
          subfinder -d $DOMAIN -all -silent -o s1.txt

          # Assetfinder (Ø³Ø±ÙŠØ¹ ÙˆØ¯Ù‚ÙŠÙ‚ØŒ Ù…ØµØ¯Ø± Ù…Ù…ØªØ§Ø²)
          assetfinder --subs-only $DOMAIN > s2.txt

          # Findomain (passive recon Ù‚ÙˆÙŠ Ø¬Ø¯Ù‹Ø§)
          findomain -t $DOMAIN -q > s3.txt 2>/dev/null || true

          # crt.sh (Ø´Ù‡Ø§Ø¯Ø§Øª SSL - Ø¢Ù„Ø§Ù Ø§Ù„Ø¯ÙˆÙ…ÙŠÙ†Ø² Ø§Ù„Ø®ÙÙŠØ©)
          curl -s "https://crt.sh/?q=%25.$DOMAIN&output=json" | jq -r '.[].name_value' 2>/dev/null | sed 's/^\*\.//' | sort -u > s4.txt

          # RapidDNS (API Ù‚ÙˆÙŠ Ù„Ù„Ø¯ÙˆÙ…ÙŠÙ†Ø² Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©)
          curl -s "https://rapiddns.io/subdomain/$DOMAIN?full=1" | grep -oE "[a-zA-Z0-9._-]+\.$DOMAIN" | sort -u > s5.txt || true

          # BufferOver (DNS dumps Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª)
          curl -s "https://dns.bufferover.run/dns?q=$DOMAIN" | jq -r '.FDNS_A[]? | split(",")[1]' 2>/dev/null | sort -u > s6.txt || true

          # Riddler (Ø¨Ø­Ø« Ù…ØªÙ‚Ø¯Ù…ØŒ Ø¬Ø§Ù…Ø¯ Ù„Ù„Ø¯ÙˆÙ…ÙŠÙ†Ø§Øª Ø§Ù„ÙØ±ÙŠØ¯Ø©)
          curl -s "https://riddler.io/search/exportcsv?q=pld:$DOMAIN" | grep -oE "[a-zA-Z0-9._-]+\.$DOMAIN" | sort -u > s7.txt || true

          # Ø¬Ù…Ø¹ Ø§Ù„ÙƒÙ„ ÙˆØªÙ†Ø¸ÙŠÙ (Ø­Ø°Ù wildcards ÙˆØªÙƒØ±Ø§Ø±ØŒ ÙÙ„ØªØ±Ø© ØµØ­ÙŠØ­Ø©)
          cat s*.txt 2>/dev/null | sort -u | grep "\.$DOMAIN$" | grep -v '*' > all-subdomains.txt
          
          echo "TOTAL_FOUND=$(wc -l < all-subdomains.txt 2>/dev/null || echo 0)" >> $GITHUB_ENV

      - name: Probe Alive Hosts (httpx Ø¬Ø§Ù…Ø¯ - ÙŠØ¹Ø±Ù Ù…ÙŠÙ† Ø¹Ø§ÙŠØ´)
        run: |
          httpx -l all-subdomains.txt \
            -silent \
            -threads 500 \
            -timeout 15 \
            -follow-redirects \
            -status-code \
            -title \
            -tech-detect \
            -o alive-with-info.txt || true

          # Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù†Ø¶ÙŠÙ (Ø¯ÙˆÙ…ÙŠÙ†Ø² Ø¨Ø³ØŒ Ø¨Ø¯ÙˆÙ† Ø¥Ù†ÙÙˆØŒ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙŠ Ø£Ø¯ÙˆØ§Øª ØªØ§Ù†ÙŠØ©)
          cut -d' ' -f1 alive-with-info.txt 2>/dev/null | sort -u > alive-clean.txt || touch alive-clean.txt
          
          echo "ALIVE_COUNT=$(wc -l < alive-clean.txt 2>/dev/null || echo 0)" >> $GITHUB_ENV

      - name: Send to Discord (Ù„Ùˆ Ø§Ù„Ù€ webhook Ù…ÙˆØ¬ÙˆØ¯)
        if: env.DISCORD_WEBHOOK != '' && env.DISCORD_WEBHOOK != '***'
        run: |
          curl -X POST -H "Content-Type: application/json" "$DISCORD_WEBHOOK" -d '{
            "content": "**Monster Recon Ø®Ù„Ù‘Øµ ÙŠØ§ ÙˆØ­Ø´!**\n**Target:** `'${{ inputs.domain }}'`\n**ÙƒÙ„ Ø§Ù„ØµØ¨ Ø¯ÙˆÙ…ÙŠÙ†Ø²:** ${{ env.TOTAL_FOUND }}\n**Ø§Ù„Ø¹Ø§ÙŠØ´ÙŠÙ†:** ${{ env.ALIVE_COUNT }}\n\nØ¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ 3 Ù…Ù„ÙØ§Øª Ù†Ø¶ÙŠÙØ©...",
            "embeds": [{"title": "Ø§Ù„Ù†ØªØ§ÙŠØ¬ Ø§Ù„Ø¬Ø§Ù…Ø¯Ø©", "color": 3066993}]
          }'
          curl -F "file=@all-subdomains.txt" -F "content=ğŸ“ 1. **ÙƒÙ„ Ø§Ù„ØµØ¨ Ø¯ÙˆÙ…ÙŠÙ†Ø² Ø§Ù„Ø®Ø§Ù…** (${{ env.TOTAL_FOUND }})" "$DISCORD_WEBHOOK"
          curl -F "file=@alive-with-info.txt" -F "content=ğŸ“ 2. **Ø§Ù„Ø¹Ø§ÙŠØ´ÙŠÙ† Ù…Ø¹ Ø³ØªØ§ØªØ³ØŒ ØªØ§ÙŠØªÙ„ØŒ ÙˆØªÙŠÙƒ** (${{ env.ALIVE_COUNT }})" "$DISCORD_WEBHOOK"
          curl -F "file=@alive-clean.txt" -F "content=ğŸ“ 3. **Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù†Ø¶ÙŠÙ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ â€“ Ø§Ø³ØªØ®Ø¯Ù… Ø¯Ù‡ ÙÙŠ Nuclei Ø£Ùˆ Ø£ÙŠ Ø£Ø¯Ø§Ø©** (${{ env.ALIVE_COUNT }})" "$DISCORD_WEBHOOK"

      - name: Upload All Results (Artifact Ø¯Ø§ÙŠÙ…Ù‹Ø§)
        uses: actions/upload-artifact@v4
        with:
          name: MONSTER-${{ inputs.domain }}-${{ github.run_number }}
          path: |
            all-subdomains.txt
            alive-with-info.txt
            alive-clean.txt

      - name: Final Success Message
        run: |
          echo "âœ… Monster recon completed successfully!"
          echo "Target: ${{ inputs.domain }}"
          echo "Total subdomains found: ${{ env.TOTAL_FOUND }}"
          echo "Alive & responding: ${{ env.ALIVE_COUNT }}"
          echo "Files ready â€“ check Discord or download artifacts!"
